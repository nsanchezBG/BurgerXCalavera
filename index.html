<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Casados x El Hambre - Web App</title>
    
    <!-- GOOGLE ANALYTICS 4 (GA4) -->
    <!-- REEMPLAZA 'G-XXXXXXXXXX' CON TU ID DE MEDICI√ìN REAL -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-NNB5GTRCZ0"></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());

      // Configuraci√≥n inicial: captura autom√°tica de Navegador, Dispositivo y Sesi√≥n
      gtag('config', 'G-NNB5GTRCZ0', {
        'send_page_view': false // Desactivamos vista de p√°gina autom√°tica para usar eventos manuales por pasos
      });
    </script>
    <!-- FIN GOOGLE ANALYTICS -->

    <!-- React & ReactDOM -->
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    
    <!-- Babel para compilar JSX en el navegador -->
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- Google Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Road+Rage&family=Oswald:wght@400;700&display=swap" rel="stylesheet">

    <style>
        /* Fuentes personalizadas */
        .font-road-rage { font-family: 'Road Rage', cursive; }
        .font-oswald { font-family: 'Oswald', sans-serif; }
        
        /* Animaciones */
        .animate-pulse-fast {
            animation: pulse 1.5s cubic-bezier(0.4, 0, 0.6, 1) infinite;
        }

        .animate-shake {
            animation: shake 0.5s cubic-bezier(.36,.07,.19,.97) both;
        }
        
        @keyframes pulse {
            0%, 100% { opacity: 1; transform: scale(1); }
            50% { opacity: .7; transform: scale(0.95); }
        }

        @keyframes shake {
            10%, 90% { transform: translate3d(-1px, 0, 0); }
            20%, 80% { transform: translate3d(2px, 0, 0); }
            30%, 50%, 70% { transform: translate3d(-4px, 0, 0); }
            40%, 60% { transform: translate3d(4px, 0, 0); }
        }

        /* Scrollbar personalizada */
        .custom-scrollbar::-webkit-scrollbar {
            width: 4px;
        }
        .custom-scrollbar::-webkit-scrollbar-track {
            background: #fff;
        }
        .custom-scrollbar::-webkit-scrollbar-thumb {
            background: #000;
        }
    </style>
</head>
<body class="bg-black overflow-hidden"> <!-- Prevent body scroll -->
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useRef, useEffect } = React;

        // --- FUNCI√ìN HELPER PARA ANALYTICS ---
        const trackEvent = (eventName, params = {}) => {
            if (typeof window.gtag === 'function') {
                window.gtag('event', eventName, params);
                console.log(`üì° GA4 Event: ${eventName}`, params);
            } else {
                console.log(`üì° GA4 Event (Simulado - falta ID): ${eventName}`, params);
            }
        };

        // --- ICONOS SVG ---
        const ArrowRight = ({ size = 24, ...props }) => (
            <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" {...props}><path d="M5 12h14"/><path d="m12 5 7 7-7 7"/></svg>
        );
        const ChevronUp = ({ size = 24, ...props }) => (
            <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" {...props}><path d="m18 15-6-6-6 6"/></svg>
        );
        const Download = ({ size = 24, ...props }) => (
            <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" {...props}><path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/><polyline points="7 10 12 15 17 10"/><line x1="12" x2="12" y1="15" y2="3"/></svg>
        );
        const RefreshCcw = ({ size = 24, ...props }) => (
            <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" {...props}><path d="M21 12a9 9 0 0 0-9-9 9.75 9.75 0 0 0-6.74 2.74L3 8"/><path d="M3 3v5h5"/><path d="M3 12a9 9 0 0 0 9 9 9.75 9.75 0 0 0 6.74-2.74L21 16"/><path d="M16 16h5v5"/></svg>
        );
        const ShareIcon = ({ size = 24, ...props }) => (
            <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" {...props}><path d="M4 12v8a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2v-8"/><polyline points="16 6 12 2 8 6"/><line x1="12" x2="12" y1="2" y2="15"/></svg>
        );
        const AlertTriangle = ({ size = 24, ...props }) => (
            <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" {...props}><path d="m21.73 18-8-14a2 2 0 0 0-3.48 0l-8 14A2 2 0 0 0 4 21h16a2 2 0 0 0 1.73-3Z"/><line x1="12" y1="9" x2="12" y2="13"/><line x1="12" y1="17" x2="12.01" y2="17"/></svg>
        );

        // --- ASSETS & CONFIG ---
        const ASSETS = {
            isotipo: "https://raw.githubusercontent.com/nsanchezBG/BurgerXCalavera/main/calaveraboyRecurso%202.png",
            logoTexto: "https://raw.githubusercontent.com/nsanchezBG/BurgerXCalavera/main/calaveraboytxtRecurso%203.png",
            logosFooter: "https://raw.githubusercontent.com/nsanchezBG/BurgerXCalavera/main/logosfooterRecurso%203.png",
            overlay: "https://raw.githubusercontent.com/nsanchezBG/BurgerXCalavera/main/overlayRecurso%205.png",
            grunge: "https://raw.githubusercontent.com/nsanchezBG/BurgerXCalavera/main/Texturelabs_Grunge_120S.jpg"
        };

        const QUOTES = [
            "Hasta que la cuenta nos separe.",
            "Prometo no revisar tu celular mientras est√°s en el ba√±o.",
            "Matrimonio v√°lido hasta el 14/02 a las 11:59 PM",
            "El hambre nos uni√≥."
        ];

        // --- APP COMPONENT ---
        function App() {
            // STEP MAPPING (Updated Flow):
            // 1: Splash
            // 2: INSTRUCTIONS + TERMS (Checkbox here)
            // 3: Marriage Names
            // 4: Camera
            // 5: Result
            const [step, setStep] = useState(1);
            const [showTerms, setShowTerms] = useState(false);
            const [termsAccepted, setTermsAccepted] = useState(false); 
            const [formError, setFormError] = useState('');
            const [couple, setCouple] = useState({ p1: '', p2: '' });
            const [capturedImage, setCapturedImage] = useState(null);
            const [randomQuote, setRandomQuote] = useState('');
            const [isSharing, setIsSharing] = useState(false);
            
            // Refs
            const videoRef = useRef(null);
            const canvasRef = useRef(null);
            const overlayImageRef = useRef(null);
            const grungeImageRef = useRef(null);
            const [stream, setStream] = useState(null);

            // --- TRACKING DROP-OUTS & SESSIONS ---
            useEffect(() => {
                // Mapa de pasos para analytics
                const stepNames = {
                    1: '01_Splash',
                    2: '02_Mecanica',
                    3: '03_Nombres',
                    4: '04_Camara',
                    5: '05_Resultado'
                };

                const currentStepName = stepNames[step];

                // 1. Rastreo de Pasos (Para ver dropouts)
                trackEvent('view_step', {
                    step_number: step,
                    step_name: currentStepName
                });

                // 2. Rastreo de inicio de sesi√≥n manual (aunque GA lo hace auto)
                if (step === 1) {
                    trackEvent('app_session_start', {
                        description: 'Usuario abri√≥ la app en Splash'
                    });
                }

            }, [step]);
            // -------------------------------------

            // --- PRELOAD ASSETS ---
            useEffect(() => {
                const img = new Image();
                img.crossOrigin = "anonymous";
                img.src = ASSETS.overlay;
                img.onload = () => { overlayImageRef.current = img; };
                
                const grunge = new Image();
                grunge.crossOrigin = "anonymous";
                grunge.src = ASSETS.grunge;
                grunge.onload = () => { grungeImageRef.current = grunge; };
            }, []);

            // --- CAMERA & CANVAS HANDLERS ---
            const startCamera = async () => {
                try {
                    const constraints = {
                        video: { 
                            facingMode: 'user',
                            width: { ideal: 1920 }, 
                            height: { ideal: 1080 },
                            aspectRatio: { ideal: 9/16 }
                        },
                        audio: false
                    };
                    const mediaStream = await navigator.mediaDevices.getUserMedia(constraints);
                    setStream(mediaStream);
                    setTimeout(() => {
                         if (videoRef.current) videoRef.current.srcObject = mediaStream;
                    }, 100);
                } catch (err) {
                    console.error("Error:", err);
                    alert("No pudimos acceder a la c√°mara. Verifica los permisos.");
                }
            };

            const stopCamera = () => {
                if (stream) {
                    stream.getTracks().forEach(track => track.stop());
                    setStream(null);
                }
            };

            const drawImageContain = (ctx, img, canvasWidth, canvasHeight) => {
                if (!img || img.naturalWidth === 0) return;
                const imgRatio = img.width / img.height;
                const canvasRatio = canvasWidth / canvasHeight;
                let renderWidth, renderHeight, offsetX, offsetY;
                if (imgRatio < canvasRatio) {
                    renderHeight = canvasHeight;
                    renderWidth = img.width * (canvasHeight / img.height);
                    offsetX = (canvasWidth - renderWidth) / 2;
                    offsetY = 0;
                } else {
                    renderWidth = canvasWidth;
                    renderHeight = img.height * (canvasWidth / img.width);
                    offsetX = 0;
                    offsetY = (canvasHeight - renderHeight) / 2;
                }
                ctx.drawImage(img, offsetX, offsetY, renderWidth, renderHeight);
            };
            
            const drawImageCover = (ctx, img, canvasWidth, canvasHeight) => {
                if (!img || img.naturalWidth === 0) return;
                const imgRatio = img.width / img.height;
                const canvasRatio = canvasWidth / canvasHeight;
                let renderWidth, renderHeight, offsetX, offsetY;
                if (imgRatio < canvasRatio) { 
                    renderWidth = canvasWidth;
                    renderHeight = img.height * (canvasWidth / img.width);
                    offsetX = (canvasWidth - renderWidth) / 2;
                    offsetY = 0;
                } else { 
                    renderHeight = canvasHeight;
                    renderWidth = img.width * (canvasHeight / img.height);
                    offsetX = (canvasWidth - renderWidth) / 2;
                    offsetY = 0;
                }
                ctx.drawImage(img, offsetX, offsetY, renderWidth, renderHeight);
            }

            function wrapText(context, text, x, y, maxWidth, lineHeight) {
                const words = text.split(' ');
                let line = '';
                for(let n = 0; n < words.length; n++) {
                    const testLine = line + words[n] + ' ';
                    const metrics = context.measureText(testLine);
                    const testWidth = metrics.width;
                    if (testWidth > maxWidth && n > 0) {
                        context.fillText(line, x, y);
                        line = words[n] + ' ';
                        y += lineHeight;
                    } else {
                        line = testLine;
                    }
                }
                context.fillText(line, x, y);
            }

            const handleCapture = () => {
                if (!videoRef.current || !canvasRef.current) return;
                const overlayImg = overlayImageRef.current;
                const grungeImg = grungeImageRef.current;

                try {
                    const video = videoRef.current;
                    const canvas = canvasRef.current;
                    const context = canvas.getContext('2d');
                    const width = video.videoWidth;
                    const height = video.videoHeight;
                    
                    canvas.width = width;
                    canvas.height = height;

                    // 1. Video
                    context.filter = 'saturate(50%) contrast(110%)';
                    context.translate(width, 0);
                    context.scale(-1, 1); 
                    context.drawImage(video, 0, 0, width, height);
                    context.setTransform(1, 0, 0, 1, 0, 0); 
                    context.filter = 'none';

                    // 2. Grunge (Invert + Multiply)
                    if (grungeImg && grungeImg.complete) {
                        context.save();
                        context.filter = 'invert(1)'; 
                        context.globalCompositeOperation = 'multiply';
                        context.globalAlpha = 0.5;
                        drawImageCover(context, grungeImg, width, height);
                        context.restore();
                    }

                    // 3. Overlay
                    if (overlayImg && overlayImg.complete) {
                        drawImageContain(context, overlayImg, width, height);
                    }

                    // 4. Texto (Sin sombra)
                    context.font = 'bold 80px "Road Rage"';
                    context.fillStyle = '#FFFFFF';
                    context.textAlign = 'center';
                    context.shadowBlur = 0; 
                    context.shadowColor = 'transparent';
                    const textY = height * 0.30; 
                    context.fillText(`${couple.p1.toUpperCase()} Y ${couple.p2.toUpperCase()}`, width / 2, textY);

                    // 5. Frase (Road Rage, Abajo)
                    const quote = QUOTES[Math.floor(Math.random() * QUOTES.length)];
                    setRandomQuote(quote);
                    context.font = 'bold 55px "Road Rage"';
                    const quoteY = height * 0.85; 
                    wrapText(context, `"${quote}"`, width / 2, quoteY, width * 0.8, 60);

                    const dataUrl = canvas.toDataURL('image/png');
                    setCapturedImage(dataUrl);
                    stopCamera();
                    
                    // Analytics: Foto capturada (paso intermedio importante)
                    trackEvent('photo_captured', {
                        quote_selected: quote
                    });

                    setStep(5); // Go to Result (Step 5 now)
                } catch (e) {
                    console.error("Error photo:", e);
                    alert("Error al procesar la imagen.");
                }
            };

            const shareOrDownloadPhoto = async () => {
                
                // TRACKING: Conversi√≥n Completada
                trackEvent('conversion_complete', {
                    method: isSharing ? 'share_api' : 'download_fallback',
                    couple_names: `${couple.p1} & ${couple.p2}`
                });

                if (!capturedImage) return;
                setIsSharing(true);
                try {
                    const response = await fetch(capturedImage);
                    const blob = await response.blob();
                    const file = new File([blob], `CasadosXElHambre_${couple.p1}_${couple.p2}.png`, { type: 'image/png' });

                    if (navigator.share && navigator.canShare && navigator.canShare({ files: [file] })) {
                        await navigator.share({
                            files: [file],
                            title: 'Casados x El Hambre',
                            text: `¬°Nos casamos por el hambre!`,
                        });
                    } else {
                        const link = document.createElement('a');
                        link.href = capturedImage;
                        link.download = `CasadosXElHambre_${couple.p1}_${couple.p2}.png`;
                        document.body.appendChild(link);
                        link.click();
                        document.body.removeChild(link);
                        if (/iPhone|iPad|iPod/i.test(navigator.userAgent)) alert("Imagen descargada. Revisa 'Archivos'.");
                    }
                } catch (error) {
                    if (error.name !== 'AbortError') alert("No pudimos compartir. Intenta guardar manualmente.");
                } finally {
                    setIsSharing(false);
                }
            };

            // --- NAVIGATION ---
            // Step 1 -> 2 (Mechanics)
            const goToMechanics = () => setStep(2);
            
            // Step 2 -> 3 (Marriage Form)
            const submitMechanics = () => {
                setFormError('');
                if (!termsAccepted) {
                    setFormError('Debes aceptar los t√©rminos y condiciones.');
                    // Tracking: Error de validaci√≥n
                    trackEvent('error_validation', {
                        step: '02_Mecanica',
                        message: 'Terminos no aceptados'
                    });
                    return;
                }
                setStep(3);
            };

            const submitMarriage = (e) => {
                e.preventDefault();
                if(couple.p1 && couple.p2) {
                    setStep(4);
                    startCamera();
                }
            };

            const repeatPhoto = () => {
                setCapturedImage(null);
                setStep(4);
                startCamera();
                
                // Tracking: Reintento
                trackEvent('photo_retake', {
                    from_step: '05_Resultado'
                });
            };

            // --- RENDERING ---

            // 1. SPLASH
            if (step === 1) {
                return (
                    <div onClick={goToMechanics} className="h-[100dvh] w-full bg-white flex flex-col items-center justify-between py-6 px-4 cursor-pointer relative overflow-hidden font-oswald animate-[fadeIn_0.7s_ease-in]">
                        <div className="flex-1 flex flex-col items-center justify-center space-y-8 w-full z-10">
                            <img src={ASSETS.isotipo} alt="Calavera" className="w-24 md:w-32 drop-shadow-xl" />
                            <div className="text-center space-y-2 animate-pulse-fast">
                                <h1 className="text-6xl md:text-8xl font-road-rage text-black uppercase leading-[0.8]">TOCA<br/>LA<br/>PANTALLA</h1>
                            </div>
                        </div>
                        <div className="w-full max-w-xs z-10">
                            <img src={ASSETS.logosFooter} alt="Logos Footer" className="w-full opacity-90" />
                        </div>
                    </div>
                );
            }

            // 2. MECHANICS + TERMS (New Step)
            if (step === 2) {
                return (
                    <div className="h-[100dvh] w-full bg-white relative flex flex-col font-oswald overflow-hidden">
                        <div className={`h-full flex flex-col items-center px-4 py-2 transition-all duration-500 ${showTerms ? 'blur-md brightness-75 scale-95' : ''}`}>
                            {/* Header */}
                            <div className="flex-none flex flex-col items-center mb-2 w-full max-w-xs pt-2">
                                <img src={ASSETS.isotipo} alt="Icon" className="w-14 mb-1" />
                                <div className="w-32">
                                    <img src={ASSETS.logoTexto} alt="Casados x El Hambre" className="w-full" />
                                </div>
                            </div>

                            {/* Content */}
                            <div className="flex-1 w-full max-w-sm flex flex-col items-center justify-center space-y-2 min-h-0">
                                
                                {/* Title Banner */}
                                <div className="bg-black text-white font-road-rage text-4xl px-4 py-1 transform -rotate-1 mb-4 text-center w-full shadow-lg">
                                    PASOS PARA PARTICIPAR
                                </div>

                                {/* Steps List - Compact */}
                                <div className="w-full space-y-3 px-1">
                                    {/* Step 1 */}
                                    <div className="flex items-center space-x-3">
                                        <div className="flex-none w-12 h-12 bg-black text-white flex items-center justify-center font-road-rage text-4xl pt-1 shadow-md">1</div>
                                        <p className="font-road-rage text-2xl md:text-3xl leading-none uppercase pt-1">
                                            PONGAN SUS NOMBRES Y ACEPTEN EL COMPROMISO.
                                        </p>
                                    </div>
                                    
                                    {/* Step 2 */}
                                    <div className="flex items-center space-x-3">
                                        <div className="flex-none w-12 h-12 bg-black text-white flex items-center justify-center font-road-rage text-4xl pt-1 shadow-md">2</div>
                                        <p className="font-road-rage text-2xl md:text-3xl leading-none uppercase pt-1">
                                            T√ìMENSE LA FOTO ‚ÄúOFICIAL‚Äù DEL MATRI.
                                        </p>
                                    </div>

                                    {/* Step 3 */}
                                    <div className="flex items-center space-x-3">
                                        <div className="flex-none w-12 h-12 bg-black text-white flex items-center justify-center font-road-rage text-4xl pt-1 shadow-md">3</div>
                                        <div className="font-road-rage text-2xl md:text-3xl leading-none uppercase pt-1">
                                            S√öBANLA A STORIES ETIQUETANDO A <br/>
                                            <span className="bg-black text-white px-1 mt-1 inline-block">@BURGERBOYPE</span> + <span className="bg-black text-white px-1 mt-1 inline-block">@CALAVERA.PIZZERIA</span>
                                        </div>
                                    </div>
                                </div>

                                {/* TERMS CHECKBOX AREA */}
                                <div className="w-full pt-4 flex flex-col items-center">
                                    <div className="flex items-center space-x-3 cursor-pointer" onClick={() => { setTermsAccepted(!termsAccepted); setFormError(''); }}>
                                        <div className={`w-6 h-6 border-2 border-black flex-none flex items-center justify-center transition-colors ${termsAccepted ? 'bg-black' : 'bg-white'}`}>
                                            {termsAccepted && <div className="w-3 h-3 bg-white" />}
                                        </div>
                                        <span className="font-oswald font-bold text-base leading-tight pt-1 uppercase">Acepto los t√©rminos y condiciones.</span>
                                    </div>
                                    
                                    <button 
                                        type="button"
                                        onClick={() => setShowTerms(true)}
                                        className="mt-2 text-xs font-bold opacity-80 hover:opacity-100 underline cursor-pointer uppercase tracking-wider"
                                    >
                                        Ver t√©rminos y condiciones
                                    </button>

                                    {formError && (
                                        <div className="flex items-center space-x-1 text-red-600 mt-2 text-sm font-bold animate-shake">
                                            <AlertTriangle size={16} />
                                            <span>{formError}</span>
                                        </div>
                                    )}
                                </div>

                                {/* CTA */}
                                <div className="pt-2 w-full flex justify-center">
                                    <button onClick={submitMechanics} className="bg-black text-white font-road-rage text-5xl px-12 py-2 hover:scale-105 transition-transform shadow-[4px_4px_0px_0px_rgba(0,0,0,0.2)]">
                                        OK, VAMOS
                                    </button>
                                </div>
                            </div>

                            {/* Footer */}
                            <div className="flex-none w-full max-w-xs pb-2 pt-2">
                                <img src={ASSETS.logosFooter} alt="Logos" className="w-full" />
                            </div>
                        </div>

                        {/* TERMS MODAL */}
                        {showTerms && (
                            <div className="absolute inset-0 z-50 flex items-center justify-center px-4 animate-[zoomIn_0.3s_ease-out]">
                                <div className="bg-black text-white p-6 w-full max-w-md border-4 border-white shadow-2xl relative h-[70vh] flex flex-col">
                                    <h2 className="font-road-rage text-4xl text-center mb-4 text-white">T√©rminos y condiciones</h2>
                                    <div className="flex-1 overflow-y-auto pr-2 text-sm text-gray-300 space-y-4 font-sans leading-relaxed custom-scrollbar">
                                        <p><strong>1. Aceptaci√≥n:</strong> Al participar en la campa√±a "Casados x El Hambre", aceptas ceder tu imagen y derechos de uso para fines promocionales de BurgerBoy y Calavera Pizzer√≠a.</p>
                                        <p><strong>2. Uso de Imagen:</strong> Autorizo a las marcas a repostear, editar y difundir la fotograf√≠a generada en sus redes sociales y medios digitales.</p>
                                        <p><strong>3. Responsabilidad:</strong> Esta es una campa√±a de entretenimiento. No tiene validez legal civil.</p>
                                        <p><strong>4. Datos:</strong> No recopilamos datos personales sensibles, √∫nicamente la imagen generada bajo tu consentimiento.</p>
                                    </div>
                                    <div className="mt-4 flex justify-center">
                                        <button onClick={() => setShowTerms(false)} className="bg-white text-black font-road-rage text-3xl px-8 py-1 hover:bg-gray-200">OK</button>
                                    </div>
                                </div>
                            </div>
                        )}
                    </div>
                );
            }

            // 3. MARRIAGE FORM (Renumbered Logic)
            if (step === 3) {
                return (
                    <div className="h-[100dvh] w-full bg-white flex flex-col font-oswald overflow-hidden">
                        <div className="h-full flex flex-col items-center px-6 py-4 animate-[slideInFromRight_0.5s_ease-out]">
                            <div className="flex-none flex flex-col items-center mb-4 w-full max-w-xs pt-4">
                                <img src={ASSETS.isotipo} alt="Icon" className="w-12 mb-1" />
                                <div className="w-28">
                                    <img src={ASSETS.logoTexto} alt="Logo" className="w-full opacity-90" />
                                </div>
                            </div>

                            <div className="flex-1 w-full max-w-sm flex flex-col justify-center min-h-0">
                                <form onSubmit={submitMarriage} className="w-full space-y-4 flex flex-col items-center">
                                    <div className="w-full space-y-1 text-center">
                                        <label className="font-road-rage text-2xl">C√≥nyuge 1</label>
                                        <input required type="text" value={couple.p1} onChange={e => setCouple({...couple, p1: e.target.value})} className="w-full bg-black text-white p-2 text-xl text-center border-2 border-black focus:outline-none rounded-none" />
                                    </div>
                                    <div className="w-full space-y-1 text-center">
                                        <label className="font-road-rage text-2xl">C√≥nyuge 2</label>
                                        <input required type="text" value={couple.p2} onChange={e => setCouple({...couple, p2: e.target.value})} className="w-full bg-black text-white p-2 text-xl text-center border-2 border-black focus:outline-none rounded-none" />
                                    </div>
                                    <h3 className="font-road-rage text-2xl text-center leading-tight pt-2 px-2">¬øAceptan soportarse hasta que la digesti√≥n los separe?</h3>
                                    <button type="submit" className="w-full bg-black text-white flex items-center justify-center space-x-2 py-3 mt-2 hover:scale-105 transition-transform shadow-xl">
                                        <span className="font-road-rage text-3xl pt-1">S√ç, ACEPTAMOS</span>
                                        <ChevronUp className="rotate-90" size={24} />
                                    </button>
                                    <span className="font-bold text-xs opacity-60">(TOMAR FOTO)</span>
                                </form>
                            </div>
                            <div className="flex-none w-full max-w-xs pb-4">
                                <img src={ASSETS.logosFooter} alt="Logos" className="w-full" />
                            </div>
                        </div>
                    </div>
                );
            }

            // 4. CAMERA VIEW
            if (step === 4) {
                return (
                    <div className="h-[100dvh] w-full bg-black relative overflow-hidden flex flex-col">
                        <video ref={videoRef} autoPlay playsInline className="absolute inset-0 w-full h-full object-cover scale-x-[-1] filter saturate-[0.5] contrast-[1.1]" onLoadedMetadata={() => videoRef.current && videoRef.current.play()} />
                        <img src={ASSETS.grunge} className="absolute inset-0 w-full h-full object-cover pointer-events-none z-10 opacity-50 mix-blend-multiply invert" />
                        <div className="absolute inset-0 pointer-events-none z-20 flex flex-col justify-between">
                            <img src={ASSETS.overlay} className="w-full h-full object-contain opacity-90 mix-blend-hard-light" alt="Overlay" />
                        </div>
                        <div className="absolute top-[30%] w-full text-center z-30 pointer-events-none px-4">
                            <h2 className="font-road-rage text-white text-5xl md:text-7xl drop-shadow-none tracking-wide">{couple.p1} Y {couple.p2}</h2>
                        </div>
                        <div className="absolute bottom-12 w-full flex justify-center z-50">
                            <button onClick={handleCapture} className="w-20 h-20 rounded-full bg-white border-4 border-gray-300 shadow-[0_0_20px_rgba(255,255,255,0.5)] active:scale-90 transition-transform flex items-center justify-center">
                                <div className="w-16 h-16 rounded-full bg-white border-2 border-black" />
                            </button>
                        </div>
                        <canvas ref={canvasRef} className="hidden" />
                    </div>
                );
            }

            // 5. RESULT VIEW
            if (step === 5) {
                return (
                    <div className="h-[100dvh] w-full bg-gray-900 relative flex flex-col items-center justify-center">
                        <div className="relative w-full h-full max-w-md mx-auto bg-black shadow-2xl overflow-hidden flex flex-col">
                            <div className="relative flex-1 bg-black flex items-center justify-center">
                                {capturedImage && <img src={capturedImage} alt="Captured" className="max-w-full max-h-full object-contain" />}
                            </div>
                            <div className="absolute inset-0 flex flex-col items-center justify-center bg-black/40 z-20 space-y-4 p-6">
                                <div className="w-full space-y-4 animate-[zoomIn_0.5s_ease-out] mt-20">
                                    <button onClick={shareOrDownloadPhoto} disabled={isSharing} className="w-full bg-white hover:bg-gray-100 text-black p-4 shadow-[4px_4px_0px_0px_rgba(0,0,0,1)] transform hover:-translate-y-1 transition-all border-2 border-black">
                                        <div className="font-road-rage text-4xl md:text-5xl leading-none flex items-center justify-center gap-2">
                                            {isSharing ? 'GUARDANDO...' : 'GUARDAR / COMPARTIR'} <ShareIcon size={32} />
                                        </div>
                                    </button>
                                    <button onClick={repeatPhoto} className="w-full bg-white hover:bg-gray-100 text-black p-4 shadow-[4px_4px_0px_0px_rgba(0,0,0,1)] transform hover:-translate-y-1 transition-all border-2 border-black">
                                        <div className="font-road-rage text-4xl md:text-5xl leading-none flex items-center justify-center gap-2">
                                            REPITE LA FOTO <RefreshCcw size={32} />
                                        </div>
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                );
            }

            return null;
        }

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>
